<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@latest"></script>
	<script src="https://cdn.jsdelivr.net/npm/@editorjs/marker@latest"></script>

	<link href="https://fonts.cdnfonts.com/css/youtube-sans" rel="stylesheet">
	<style>
		* {
			box-sizing: border-box;
		}

		.column {
			float: left;
			width: 50%;
			height: 100vh;
		}

		.row:after {
			content: "";
			display: table;
			clear: both;
		}

		.row {
			margin: 0 auto;
			width: 768px;
		}

		body {
			font-family: 'YouTube Sans Dark', sans-serif;
			margin: 0 auto;
			background: white;
		}

		.textarea {
			width: 100%;
			border: none;
			outline: none;
			box-shadow: none;
			resize: none;
			font-size: 12px;
			line-height: 24px;
			font-family: 'YouTube Sans Dark', sans-serif;
			padding: 20px;
		}

		#translated-text {
			background-color: whitesmoke;
			color: slategrey;
		}

		.ce-toolbar__actions {
			display: none;
		}

		.ce-popover__items>*,
		.ct--top {
			display: none !important;
		}

		.ce-popover__items>*[data-item-name="Marker"] {
			display: block !important;
		}

		.cdx-marker {
			background: blanchedalmond;
			padding: 2px 0px;
			border-radius: 2px;
		}

		#source-text .cdx-marker {
			background: #d4ecff;

		}
	</style>

	<style>
#snackbar {
  visibility: hidden;
  min-width: 250px;
  margin-left: -125px;
  background-color: #333;
  color: #fff;
  text-align: center;
  border-radius: 2px;
  padding: 16px;
  position: fixed;
  z-index: 1;
  left: 50%;
  bottom: 30px;
  font-size: 17px;
}

#snackbar.show {
  visibility: visible;
  -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
  animation: fadein 0.5s, fadeout 0.5s 2.5s;
}

@-webkit-keyframes fadein {
  from {bottom: 0; opacity: 0;} 
  to {bottom: 30px; opacity: 1;}
}

@keyframes fadein {
  from {bottom: 0; opacity: 0;}
  to {bottom: 30px; opacity: 1;}
}

@-webkit-keyframes fadeout {
  from {bottom: 30px; opacity: 1;} 
  to {bottom: 0; opacity: 0;}
}

@keyframes fadeout {
  from {bottom: 30px; opacity: 1;}
  to {bottom: 0; opacity: 0;}
}
</style>
</head>

<body>
	<div class="row">

		<div class="column">
			<div id="source-text" class="textarea"></div>

		</div>
		<div class="column">
			<div id="translated-text" class="textarea"></div>
		</div>
	</div>

	<div id="snackbar">Saved</div>
	<script>


		const sourceContent = JSON.parse(localStorage.getItem(getStorageKey('source')));
		const translatedContent = JSON.parse(localStorage.getItem(getStorageKey('translated')));

		const sourceEditor = new EditorJS({
			holder: 'source-text',
			tools: {
				Marker: {
					class: Marker,
					shortcut: 'CMD+SHIFT+M',
				}
			},
			data: sourceContent || {}, // Load saved content or start with empty
		});

		const translatedEditor = new EditorJS({
			holder: 'translated-text',
			tools: {
				Marker: {
					class: Marker,
					shortcut: 'CMD+SHIFT+M',
				}
			},
			data: translatedContent || {}, // Load saved content or start with empty
		});

		function getStorageKey(suffix) {
			return `${location.hash || '#default'}-${suffix}`;
		}

		function loadText() {
			sourceText.value = localStorage.getItem(getStorageKey('source')) || '';
			translatedText.value = localStorage.getItem(getStorageKey('translated')) || '';
		}

		function saveText() {
			sourceEditor.save().then((outputData) => {
				localStorage.setItem(getStorageKey('source'), JSON.stringify(outputData));
			}).catch((error) => {
				console.error('Saving failed: ', error);
			});

			translatedEditor.save().then((outputData) => {
				localStorage.setItem(getStorageKey('translated'), JSON.stringify(outputData));
			}).catch((error) => {
				console.error('Saving failed: ', error);
			});


			 var x = document.getElementById("snackbar");
			  x.className = "show";
			  setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
			// localStorage.setItem(getStorageKey('source'), sourceText.value);
			// localStorage.setItem(getStorageKey('translated'), translatedText.value);
			//alert('Text saved!');
		}

		const sourceText = document.getElementById('source-text');
		const translatedText = document.getElementById('translated-text');

		// Load text based on hash
		loadText();

		// Listen for hash changes and reload text
		window.addEventListener('hashchange', loadText);

		// Save text when Ctrl + S (Windows/Linux) or Cmd + S (Mac) is pressed
		document.addEventListener('keydown', (event) => {
			if ((event.ctrlKey || event.metaKey) && event.key === 's') {
				event.preventDefault();
				saveText();
			}
		});

		window.onunload = function() {
  			if (confirm("Do you want to save it!") == true) {
     				saveText();
  			}	 
		};
	</script>
</body>

</html>
